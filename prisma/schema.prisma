generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Account {
  AccountID    Int              @id @unique @default(autoincrement())
  Privilege    AccountPrivilege @default(USER)
  EmailAddress String           @unique @db.Citext
  Password     String
  FirstName    String
  LastName     String
  Username     String           @unique
  PwdResetCode String?          @unique
  PwdRstCdExp  DateTime?
  likedMerch   LikedMerch[]
  merch        Merch[]
}

model LikedMerch {
  LikeID    Int     @id @default(autoincrement())
  AccountID Int
  MerchID   Int
  account   Account @relation(fields: [AccountID], references: [AccountID], onDelete: Cascade)
  merch     Merch   @relation(fields: [MerchID], references: [MerchID], onDelete: Cascade)

  @@unique([AccountID, MerchID])
}

model Merch {
  MerchID     Int              @id @unique @default(autoincrement())
  AccountID   Int
  PostTime    DateTime         @default(now())
  StockStatus MerchStockStatus
  Price       Float
  Name        String
  Description String
  Length      Float?
  Width       Float?
  Height      Float?
  Mass        Float?
  Material    MerchMaterial
  Condition   MerchCondition
  HUnit       LengthUnit?
  LUnit       LengthUnit?
  MUnit       MassUnit?
  WUnit       LengthUnit?
  likedBy     LikedMerch[]
  seller      Account          @relation(fields: [AccountID], references: [AccountID],  onDelete: Cascade)
  Image       MerchImage[]
}

model MerchImage {
  ImageID      Int      @id @unique @default(autoincrement())
  MerchID      Int
  FileName     String
  MIMEType     String
  Data         Bytes
  CreationTime DateTime @default(now())
  merch        Merch    @relation(fields: [MerchID], references: [MerchID], onDelete: Cascade)
}

model User {
  id       Int    @id @default(autoincrement())
  email    String @unique
  password String
  role     Role   @default(USER)
}

model Stuff {
  id        Int       @id @default(autoincrement())
  name      String
  quantity  Int
  condition Condition @default(good)
  owner     String
}

enum AccountPrivilege {
  USER
  ADMIN
}

enum MerchStockStatus {
  ON_STOCK
  SOLD
  RECALLED
}

enum LengthUnit {
  MILLIMETER
  CENTIMETER
  DECIMETER
  METER
  INCH
  FEET
  YARD
  MILE
}

enum MassUnit {
  MILLIGRAM
  GRAM
  KILOGRAM
  TON
  OUNCE
  POUND
}

enum MerchCondition {
  NEW
  EXCELLENT
  GOOD
  FAIR
  POOR
}

enum MerchMaterial {
  ALUMINUM
  BAMBOO
  BRASS
  BRONZE
  CARBON
  CERAMIC
  CLOTH
  COPPER
  FABRIC
  GLASS
  GOLD
  IRON
  LEATHER
  PAPER
  PLASTIC
  RUBBER
  SILVER
  STEEL
  STONE
  TITANIUM
  WOOD
  OTHER
}
